# Orderly SDK Plugin System Reference

## Plugin Types

| Type | Description | Integration |
|:-----|:------------|:------------|
| **Widget** | UI block mounted at a specific anchor in the trading page | Interceptor with `target` path |
| **Page** | Standalone page built with SDK UI + Hooks | Host router mounts as normal route |
| **Layout** | Top-level container that rearranges child blocks | Intercepts `TradingLayout` |

## Plugin Structure

A plugin is an **npm package + registration function**:

```typescript
export default function registerMyPlugin(options?: MyPluginOptions) {
  return (SDK: OrderlySDK) => {
    SDK.registerPlugin({
      id: "orderly-plugin-my-plugin-abc12345",
      name: "My Plugin",
      version: "1.0.0",
      orderlyVersion: ">=2.9.0",
      interceptors: [ /* ... */ ],
      setup: (api) => { /* event subscriptions, non-UI logic */ },
    });
  };
}
```

## registerPlugin Fields

| Field | Type | Required | Description |
|:------|:-----|:---------|:------------|
| `id` | `string` | Yes | Globally unique ID (generated by this skill) |
| `name` | `string` | No | Human-readable name |
| `version` | `string` | No | Plugin version (semver) |
| `orderlyVersion` | `string` | No | SDK version requirement |
| `interceptors` | `PluginInterceptor[]` | No | UI interceptor definitions |
| `setup` | `(api) => void` | No | Non-UI logic entry point |
| `onInitialize` | `() => void` | No | After code load, before mount |
| `onInstall` | `() => void` | No | First time installed |
| `onError` | `(error) => void` | No | Error handler |
| `onFallback` | `() => ReactNode` | No | Fallback UI on error |

## Interceptor Signature

```typescript
component: (Original, props, api) => ReactNode
```

- **Original**: the previous component in the chain (or default)
- **props**: the props that the target component receives
- **api**: injected Plugin API facade

### createInterceptor (recommended)

```typescript
import { createInterceptor } from "@orderly.network/plugin-core";

createInterceptor("OrderBook.Desktop.Asks", (Original, props, api) => {
  // props are auto-typed from the target path
  return <Original {...props} />;
});
```

### Three Interception Strategies

1. **Enhance**: render extra content around `Original`
2. **Wrap**: wrap `Original` in a provider or styled container
3. **Replace**: completely replace `Original` (use with caution)

## Plugin API (`api`)

```typescript
interface OrderlyPluginAPI {
  data: {
    useAccount: () => AccountInfo;
    useOrderBook: (symbol: string) => OrderBookData;
  };
  actions: {
    placeOrder: (params) => Promise<any>;
    cancelOrder: (id: string) => Promise<any>;
  };
  utils: {
    formatAmount: (val: number) => string;
    toast: { success: (msg) => void; error: (msg) => void };
  };
  events: {
    on: (event: string, handler: (data) => void) => void;
    off: (event: string, handler: (data) => void) => void;
  };
}
```

Alternatively, use `@orderly-network/hooks` directly in interceptor components.

## Lifecycle Hooks

| Hook | Timing | Use Case |
|:-----|:-------|:---------|
| `onInitialize` | Code loaded, before mount | Init state, subscribe events |
| `onInstall` | First installation | Version compatibility check |
| `onMount` | Component enters DOM | Timers, analytics |
| `onUnmount` | Component removed from DOM | Cleanup side effects |
| `onDispose` | Plugin fully disabled | Clear persisted data |

## Host Integration

```tsx
import { OrderlyProvider } from "@orderly-network/sdk-ui";
import registerMyPlugin from "@orderly.network/plugin-my-plugin";

<OrderlyProvider plugins={[registerMyPlugin({ /* options */ })]}>
  <TradingPage />
</OrderlyProvider>
```

## Key Dependencies

| Dependency | Version |
|:-----------|:--------|
| Node.js | >=20.19.0 |
| pnpm | >=10.0.0 |
| React | >=18 |
| TypeScript | ^5.1.6 |
| tsup | ^8.5.1 |
| `@orderly.network/plugin-core` | workspace:* |
